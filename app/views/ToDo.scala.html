@import model.viewValue.ViewValueToDo
@import model.ToDoCategory
@import java.time.format.DateTimeFormatter
@import helper.CSRF

@(vv: model.viewValue.ViewValueToDo)(implicit request: RequestHeader)
@common.Default(vv){
<ul>
  <li><a href="@routes.HomeController.index()">Home</a></li>
  <li><a>カテゴリー一覧</a></li>
</ul>

<div class="todo-div">
  <div class="legend">
    @for(color <- ToDoCategory.Color.values) {
      <div>
        <span style="background-color: @color.toString"></span> @color.categoryName
      </div>
    }
  </div>
<div class="todo-list">
  @for((todo, categoryOpt) <- vv.todos) { 
    <div class="todo-item" id="todo-@todo.v.id.getOrElse(0L)">
      <div class="todo-content">
        <div class="title-div">
          <input type="checkbox" class="round-checkbox" onchange="deleteTodoAjax(@todo.v.id.getOrElse(0L))" />
          <div class="todo-title">@todo.v.title</div>
        </div>
        <div class="todo-body">@todo.v.body</div>
        <div class="todo-dates">
          @defining(DateTimeFormatter.ofPattern("yyyy-MM-dd")) { dateFormatter =>
          <div>作成日: @todo.v.createdAt.format(dateFormatter)</div>
          <div>更新日: @todo.v.updatedAt.format(dateFormatter)</div>
          }
        </div>
      </div>
      <!-- 削除フォーム（非表示にしておく） -->
      <form id="delete-form-@todo.v.id.getOrElse(0L)" action="@routes.ToDoController.deleteToDo(todo.v.id.getOrElse(0L))"
        method="post" style="display: none;">
        @CSRF.formField
      </form>
      <div class="todo-status-category">
        <div class="todo-status">@todo.v.state.name</div>
        <div class="todo-category">
          <span class="category-color" style="background-color: @categoryOpt.fold(" #FFFFFF")(_.v.color.toString)"></span>
        </div>
      </div>
    </div>
  }
</div>
}