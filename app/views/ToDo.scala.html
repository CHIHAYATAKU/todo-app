@import model.viewValue.ViewValueToDo
@import java.time.format.DateTimeFormatter
@import helper.CSRF

@(vv: model.viewValue.ViewValueToDo)(implicit request: RequestHeader)
@common.Default(vv){
<ul>
  <li><a href="@routes.HomeController.index()">Home</a></li>
  <li><a>カテゴリー一覧</a></li>
</ul>

<div class="todo-div">
  <div class="legend">
    @for((todo,categoryOpt) <- vv.todos) {
      <div>
        @{
          val categoryHtml = categoryOpt match {
            case Some(category) =>
              s"""
                <div>
                  <span style="background-color: ${category.v.color.name}"></span>
                  ${category.v.name}
                </div>
              """
            case None =>
              "<div>None category</div>"
          }
          Html(categoryHtml)
        }
      </div>
    }
  </div>
  <div class="todo-list">
    @for((todo, categoryOpt) <- vv.todos) { <div class="todo-item">
      <div class="todo-content">
        <div class="todo-title">@todo.v.title</div>
        <div class="todo-body">@todo.v.body</div>
        <div class="todo-dates">
          @defining(DateTimeFormatter.ofPattern("yyyy-MM-dd")) { dateFormatter =>
          <div>作成日: @todo.v.createdAt.format(dateFormatter)</div>
          <div>更新日: @todo.v.updatedAt.format(dateFormatter)</div>
          }
        </div>
      </div>
      <div class="todo-status-category">
        <div class="todo-status">@todo.v.state.name</div>
        <div class="todo-category">
          <span class="category-color" style="background-color: @categoryOpt.fold(" #FFFFFF")(_.v.color.name)"></span>
        </div>
      </div>
  </div>
  <div class="todo-actions">
    <form action="@routes.ToDoController.deleteToDo(todo.v.id.getOrElse(0L))" method="post">
      @CSRF.formField
      <button type="submit">削除</button>
    </form>
  </div>
  }
</div>
}

